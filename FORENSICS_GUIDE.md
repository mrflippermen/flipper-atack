# ðŸ”¬ FORENSICS ANALYSIS GUIDE
## Blue Team Artifact Detection & Timeline Reconstruction

---

## ðŸŽ¯ Purpose

This guide helps digital forensic analysts and incident responders identify, extract, and analyze artifacts generated by the AUSTRALIS Red Team modules. Each section maps to specific attack modules and provides detection strategies.

---

## ðŸ§° Recommended Forensic Toolkit

### Essential Tools

| Tool | Purpose | Download |
|:-----|:--------|:---------|
| **KAPE** | Artifact collection triage | [Eric Zimmerman](https://ericzimmerman.github.io/) |
| **EvtxECmd** | Windows Event Log parsing | [Eric Zimmerman](https://ericzimmerman.github.io/) |
| **Registry Explorer** | Registry hive analysis | [Eric Zimmerman](https://ericzimmerman.github.io/) |
| **MFTECmd** | Master File Table parser | [Eric Zimmerman](https://ericzimmerman.github.io/) |
| **PECmd** | Prefetch analysis | [Eric Zimmerman](https://ericzimmerman.github.io/) |
| **Volatility 3** | Memory forensics | [volatilityfoundation.org](https://www.volatilityfoundation.org/) |
| **PowerShell-Arsenal** | PowerShell log decoder | GitHub |

---

## ðŸ“‹ Artifact Matrix by Module

### ðŸ”‘ Credential_Phishing

#### Primary Artifacts

**1. PowerShell Script Block Logging (Event ID 4104)**
```
Location: C:\Windows\System32\winevt\Logs\Microsoft-Windows-PowerShell%4Operational.evtx
```

**Detection**:
```powershell
# Extract with EvtxECmd
EvtxECmd.exe -f "Microsoft-Windows-PowerShell%4Operational.evtx" --csv . --csvf phishing.csv

# Search for credential prompts
Select-String -Path .\phishing.csv -Pattern "Get-Credential|CredentialUI"
```

**2. Alternate Data Streams (ADS)**
```
Location: C:\Users\*\AppData\Local\Temp\*.txt:*
```

**Detection**:
```powershell
# Enumerate ADS
Get-ChildItem -Path $env:TEMP -Recurse | Get-Item -Stream * | Where-Object Stream -ne ':$DATA'

# Read hidden stream
Get-Content -Path "C:\Users\...\readme.txt" -Stream "auth_token"
```

**3. Network Connections**
```
Exfiltration to: api.dropboxapi.com, discord.com/api/webhooks
```

**Timeline Indicators**:
- Mouse movement pause â†’ Credential prompt â†’ Dropbox upload (< 5 seconds)

---

### â±ï¸ Persistence_Keylogger

#### Primary Artifacts

**1. Timestomping Detection (USN Journal)**
```
Location: C:\$Extend\$UsnJrnl:$J
```

**Detection**:
```powershell
# Extract USN Journal with FTK Imager or fsutil
fsutil usn readjournal C: csv > usnjrnl.csv

# Compare with MFT timestamps
MFTECmd.exe -f "C:\$MFT" --csv . --csvf mft.csv

# Look for mismatches (keylogger script timestamp = kernel32.dll)
# Real creation time in USN, fake time in $MFT
```

**2. PowerShell Process Persistence**
```
Registry: HKCU\Software\Microsoft\Windows\CurrentVersion\Run
Task Scheduler: \Microsoft\Windows\[random]
```

**Detection**:
```powershell
# Registry persistence
Get-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run"

# Scheduled Tasks
Get-ScheduledTask | Where-Object {$_.Actions.Execute -like "*powershell*"}
```

**3. Kill Switch File**
```
Location: C:\Users\[user]\AppData\Local\Temp\stop.txt
```

**Detection**: Presence indicates attacker executed cleanup

---

### ðŸŒ Discovery_WiFi_Exfiltration

#### Primary Artifacts

**1. WiFi Profile Extraction**
```
Command History: netsh wlan export profile key=clear
Output: C:\Users\[user]\Documents\WiFi-Profiles-YYYY-MM-DD\*.xml
```

**Detection**:
```powershell
# Event ID 4104 - Look for netsh wlan commands
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-PowerShell/Operational'; ID=4104} | 
    Where-Object {$_.Message -like "*netsh*wlan*export*"}

# Prefetch evidence
PECmd.exe -f "C:\Windows\Prefetch\NETSH.EXE-*.pf"
```

**2. ZIP Compression**
```
Tool: System.IO.Compression.ZipFile (PowerShell)
Output: WiFi-Profiles-*.zip
```

**Detection**: Large ZIP in temp folders or Documents

---

### ðŸ“¦ Collection_BrowserForensics

#### Primary Artifacts

**1. ShellBags (Folder Access)**
```
Location: NTUSER.DAT\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\BagMRU
```

**Detection**:
```powershell
# Extract with ShellBagsExplorer (Eric Zimmerman)
# Look for access to:
# - C:\Users\[user]\AppData\Local\Google\Chrome\User Data
# - C:\Users\[user]\AppData\Local\Microsoft\Edge\User Data
```

**2. LNK Files (Recent Items)**
```
Location: C:\Users\[user]\AppData\Roaming\Microsoft\Windows\Recent\*.lnk
```

**Detection**:
```powershell
# Parse with LECmd
LECmd.exe -d "C:\Users\[user]\AppData\Roaming\Microsoft\Windows\Recent" --csv .
```

**3. Browser Database Access**
```
Files: History, Login Data, Cookies (SQLite databases)
```

**Detection**:
```powershell
# Check USN Journal for database locks
# Event ID 4663 (Object Access) if auditing enabled
```

---

### ðŸ” Discovery_System_Recon

#### Primary Artifacts

**1. USN Journal Flood**
```
Indicator: 1000+ rapid file create/delete events within seconds
```

**Detection**:
```powershell
# Analyze USN Journal frequency
# Group by timestamp - look for anomalous spikes
Import-Csv usnjrnl.csv | Group-Object -Property Timestamp | 
    Where-Object Count -gt 100
```

**2. Massive Script Block Log**
```
Event ID 4104 with 10,000+ character payload (base64 encoded data)
```

**Detection**:
```powershell
# Extract large script blocks
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-PowerShell/Operational'; ID=4104} | 
    Where-Object {$_.Message.Length -gt 10000}
```

**3. WMI Queries**
```
Event ID 5857/5858/5859/5860/5861 (WMI-Activity)
```

**Detection**: Unusual WMI query patterns for system enumeration

---

### ðŸ›¡ï¸ Defense_Evasion_Cleanup

#### Primary Artifacts

**What's MISSING is the Artifact**:
- Cleared PowerShell history
- Empty RecycleBin (despite recent activity)
- Cleared Run dialog MRU
- Deleted temp files

**Detection**:
```powershell
# Check for history file deletion
# Location: $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
# If missing or truncated timestamp = indicator

# Registry Run dialog cleared
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU"
# Few or no entries = suspicious

# USN Journal shows deletion spike
# Filter for "Delete" reason codes
```

---

## ðŸ§¬ Memory Forensics

### Memory Dump Acquisition

```powershell
# Using DumpIt (free tool)
DumpIt.exe /O C:\Forensics\memdump.raw

# Or use WinPmem
winpmem_mini_x64_rc2.exe memdump.raw
```

### Volatility 3 Analysis

**Detect PowerShell in Memory**:
```bash
vol -f memdump.raw windows.pslist | grep powershell
vol -f memdump.raw windows.cmdline | grep powershell
```

**Extract PowerShell Scripts**:
```bash
vol -f memdump.raw windows.psscan
vol -f memdump.raw windows.handles --pid [powershell_pid]
```

**Find Injected Code**:
```bash
vol -f memdump.raw windows.malfind
```

---

## ðŸ“Š Timeline Reconstruction

### SuperTimeline with Plaso

```bash
# Create timeline
log2timeline.py --parsers "winreg,winevt,prefetch,mft,usnjrnl" timeline.plaso C:\

# Filter to attack timeframe
psort.py -o l2tcsv -w timeline.csv timeline.plaso "date > '2026-01-20 09:00:00'"
```

### Key Timeline Events

```
09:30:00 - USB device insertion (Event ID 20001 - USB Device)
09:30:05 - PowerShell.exe execution (Prefetch, Event ID 4688)
09:30:08 - Script Block Logging (Event ID 4104)
09:30:10 - Network connection to api.dropboxapi.com (Event ID 5156)
09:30:15 - File creation in Temp (USN Journal)
09:35:00 - Cleanup activities (USN deletions)
```

---

## ðŸŽ“ Practice Exercises

### Exercise 1: Credential Phishing Detection
1. Execute `Credential_Phishing` module
2. Extract Event ID 4104 logs
3. Identify credential prompt code
4. Find ADS artifacts
5. Reconstruct exfiltration timeline

### Exercise 2: Keylogger Persistence
1. Execute `Persistence_Keylogger` module
2. Compare USN Journal vs $MFT timestamps
3. Identify timestomping
4. Locate persistence mechanism
5. Find kill switch file

### Exercise 3: System Reconnaissance
1. Execute `Discovery_System_Recon` module
2. Analyze USN Journal for file operation anomalies
3. Extract base64 payload from Event ID 4104
4. Decode and analyze exfiltrated data structure
5. Map MITRE ATT&CK techniques used

---

## ðŸ“ž Resources

- **MITRE ATT&CK**: [https://attack.mitre.org/](https://attack.mitre.org/)
- **SANS Posters**: [https://www.sans.org/posters/](https://www.sans.org/posters/)
- **Eric Zimmerman Tools**: [https://ericzimmerman.github.io/](https://ericzimmerman.github.io/)
- **Volatility**: [https://www.volatilityfoundation.org/](https://www.volatilityfoundation.org/)

---

**Happy Hunting!** ðŸ”ŽðŸ¦˜
